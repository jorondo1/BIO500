---
title: "Caractérisation d'un réseau de collaboration d'étudiants en biologie."
author: 
  - name : "Amélie Harbeck-Bastien" 
    affiliation : "a"
  - name : "Samuel Fortin"
    affiliation : "a"
  - name : "Jonathan Rondeau-Leclaire"
    affiliation : "a"
address :
  - code: "a"
    address : "Université de Sherbrooke, Département de biologie, 2500, Boulevard de l'Université, Sherbrooke, Québec, J1K 2R1"
    
abstract: |
  Lorem ipsum
    
date: "`r Sys.Date()`"
bibliography: bibliographie.bib
output:
  html_document:
  fig_caption: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.cap = " ")
library(pacman)
p_load(tidygraph, igraph, dplyr, GGally, network, sna, intergraph, magrittr,
       RColorBrewer, NetworkToolbox, sparsebnUtils, spaa, tibble, rstatix, ggpubr,
       visNetwork,gridExtra,knitr, patchwork)
```

__TOTAL DU TEXTE : 1000 à 1500 mots (excl. code)__

# Résumé

# Introduction
Court, expliquer nos questions

Présenter notre réseau. 

```{r fig1, Reseau interactif, fig.cap="\\label{fig:fig1} Réseau de collaboration entre les étudiants de la classe du cours BIO500 à l'Université de Sherbrooke à l'hiver 2023.", fig.width=7, fig.height=6}
noeuds_arcs <- tar_read(noeuds_arcs) # importer target pour fetch les df de noeuds et d'arcs utilisés par visNetwork
#VisNetwork; en cliquant on peut voir le Cci

visNetwork(nodes = noeuds_arcs[[1]], edges = noeuds_arcs[[2]]) %>% 
  visIgraphLayout() %>% 
  visOptions(
    highlightNearest = list(enabled = TRUE, # interactivité
                            hover = TRUE, # pas besoin de cliquer
                            degree = 1, # montrer 1 niveau de collab
                            hideColor = "#F2F2F2", # cacher les autres niveaux
                            algorithm = "hierarchical",
                            labelOnly = FALSE), # cacher les autres labels
             nodesIdSelection = TRUE)
```

Puis, on fait référence à la Figure \ref{fig:plot1} dans le texte.

# Méthodes
Courte description

- Collecte de données 
- Nettoyage des données 
- Sélection du noyau de la classe
- Liste packages utilisés avec leur utilisation (tests stats + graphiques)
- Description des tests statistiques




# Résultats
Courte section

```{R tab1, tab.cap="\\label{tab:tab1} Informations générales du réseau global et du sous-réseau du noyau des étudiants de la classe."}
df_stats <- tar_read(df_stats)
kable(x=df_stats,format="html",digits=2,align="c", col.names=c("Tous les étudiants","Noyau de la classe"), caption="Informations générales du réseau global et du sous-réseau du noyau des étudiants de la classe",table.attr = "style='width:100%;'")
```

Dans le texte je peux réféfer à la table \ref{tab:tab1}. Mais ça marche po hihi

```{R Tests de normalité des distributions de cci à travers les groupes, echo=FALSE}
# H0: la variable cci suit une distribution normale
df_noeuds_classe <- tar_read(df_noeuds_classe) # importer target du df des noeuds de la classe avec informations et cci

df_noeuds_classe %>% group_by(form) %>% 
  filter(form != "Inconnu") %>% # Les inconnus sont retirés car ils ne seront pas utilisés dans les tests statistiques suivants
  shapiro_test(cci)

df_noeuds_classe %>% group_by(annee)%>% 
  filter(annee != "Inconnu") %>% 
  shapiro_test(cci)

df_noeuds_classe %>% group_by(regime) %>% 
  filter(regime != "Inconnu") %>% 
  shapiro_test(cci) 

# le cci est normalement distribuée à travers tous les groupes lorsque les inconnus sont retirés.
```

```{R Test de Dunn, echo=FALSE}
# H0: tous les groupes ont la même distribution de cci
form.stat <- df_noeuds_classe %>% 
  filter(form != "Inconnu") %>% 
    dunn_test(cci ~ form) # NS

annee.stat <- df_noeuds_classe %>% 
  filter(annee != "Inconnu") %>% 
    dunn_test(cci ~ annee) # SIGNIFICATIF

reg.stat <- df_noeuds_classe %>%
    filter(regime != "Inconnu") %>% 
    dunn_test(cci ~ regime) # NS
```

```{R fig2, Boxplots, fig.cap="\\label{fig:fig2}Comparaison de la distribution des coefficients de regroupements individuels par caractéristique du parcours des personnes étudiantes.", fig.width=9, fig.height=9, echo=FALSE}

# CCi par formation préalable
cciForm.plot <- df_noeuds_classe %>% filter(form!="Inconnu") %>% 
  ggplot(aes(x = form, y = cci)) +
  geom_boxplot(aes(fill = form)) + geom_point(position="jitter") +
  theme_light() +
  theme(legend.position="none")+ # Hide legend
  stat_pvalue_manual(form.stat,  
                    label = "p.adj.signif", 
                    tip.length = 0.01, 
                    y.position = 2.2, 
                    step.increase = 0.06) + # Add stat test
  labs(x = "Formation préalable", y = "Coefficient de regroupement")


# CCi par programme (coop vs régulier)
cciReg.plot <- df_noeuds_classe %>% filter(regime!="Inconnu") %>% 
  ggplot(aes(x = regime, y = cci)) +
  geom_boxplot(aes(fill = regime)) + geom_point(position="jitter") +
  theme_light() +
  theme(legend.position="none")+ # Hide legend
  stat_pvalue_manual(reg.stat,  
                     label = "p.adj.signif",
                     y.position = 2.2) + # Add stat test
  labs(x = "Régime", y="Coefficient de regroupement")

# CCi par session de début de bac
cciYr.plot <- df_noeuds_classe %>% filter(annee!="Inconnu") %>% 
  ggplot(aes(x = annee, y = cci)) +
  geom_boxplot(aes(fill = annee)) + geom_point(position="jitter") +
  theme_light() +
    theme(legend.position="none")+ # Hide legend
    stat_pvalue_manual(annee.stat,  
                       label = "p.adj.signif",
                       y.position = 2.2) + # Add stat test
    labs(x = "Première session", y='')

# Créer une figure avec les trois figures dedans
(cciReg.plot | cciYr.plot) / cciForm.plot +
    plot_annotation(tag_levels = 'A') &
  ylim(0,2.5)

```

```{R "Visualisation du réseau en fonction de l'année de début"}
net <- tar_read(network)

set.seed(3)

ggnet2(net, color="annee", palette='Set2', 
                    edge.color="colWeight", 
                    edge.size = "sizeWeight",
                    size=5, node.alpha = "aNA_start")
```


# Discussion
doit inclure des citations de la littérature (peut-être en lien avec les limitations de nos méthodes, et des parallèles avec la littérature sur les réseaux écologiques)

# Bibliographie
